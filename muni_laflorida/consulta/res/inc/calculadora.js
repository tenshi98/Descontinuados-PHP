var Wextensible=Wextensible||{};Wextensible.CALCULADORA_JS=function(){Wextensible.Calculadora=(function(){var wxG=Wextensible.general;var PC="PRECALC";var tempConstructor=function(nombreInstancia,dondePoner){this.nombre="";try{if((nombreInstancia!=null)&&(nombreInstancia!="")){this.nombre=nombreInstancia;}else{alert("El nombre de la calculadora es obligatorio");return;}}catch(e){alert("Error al comprobar nombre para nueva calculadora "+nombreInstancia);return;}this.idDondePoner="";if((dondePoner!=null)&&(dondePoner!="")){if(typeof(dondePoner)=="string"){this.idDondePoner=dondePoner;}else{alert("Error, se esperaba el argumento 'dondePoner' como un string para "+"crear una calculadora '"+this.nombre+"'");return}}else{alert("Error, se esperaba el argumento 'dondePoner' para "+"crear una calculadora '"+this.nombre+"'");return;}this.acumulador=0;this.memoria=0;this.hayUnOperando=false;this.hayUnOperador=false;this.operacionUltima="";this.operacionActual="";try{var thtml="<div id='"+PC+this.nombre+"calculadora' "+"class='"+PC+"calculadora' >"+"<input class='"+PC+"pantalla' size='24' maxlength='24' value='0' "+"id ='"+PC+this.nombre+"pantalla' "+"onfocus = '"+this.nombre+".enfocaPantalla()' "+"onkeypress = '"+this.nombre+".entrarPantalla(event)' "+"/><br />"+"<input type='button' class='"+PC+"operacion' value='can' "+"id='"+PC+"cancela' title='cancela operaciones' "+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"operacion' value='bor' "+"id='"+PC+"borra' title='borra último operando'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"operacion' value='ret' "+"id='"+PC+"retrocede'  title='retrocede un dígito'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/>&nbsp;&nbsp; "+"<a class='"+PC+"vinculo_logo' href='../../'  "+"title='www.wextensible.com'> wextensible.com <img src='"+"data:image/gif;base64,R0lGODlhDwAPAPcAAAAAAIAAAACAAICAAAAAgIAAgACAgICAgMDAwP8AAAD/AP//"+"AAAA//8A/wD//////3gAOQA2AC4AYgBtAHAAAAAAAAAAML9bAND4EgDQ+BIAAAAUACICknwkAAAASA0UAAAAFA"+"DQhBUAqPgSAKT5EgDs+hIAIOmRfCgCknz/////IgKSfJsBknzbAZJ8AAAAAKhySAD/////uGs7ALj5EgDWexVb"+"8wsEvAj5EgAAAAAAuACSfPDkGADU+RIAQQCSfHgHFABdAJJ8GOUYAPjkGABkIBkAiNlyAET5EgB4ARQAiNlyAF"+"AgGQAAAAAAFPsSADUEknx4ARQAEIwVACQAAgBY+hIA3AAAAIhDknxs+RIAAAAAALgAknxQPBUAOPoSAID5EgAA"+"AAAAuACSfEggGQBM+hIAQQCSfNgHFABdAJJ8ZCAZAFAgGQAAAAAAAAAUAAiKFQAAAAAArPkSAHsAAAACAAAA9g"+"ABAAUAAAAY+RIAEQAAAAD6EgAg6ZF8YACSfP////9dAJJ8UhSSfIMUknwg4Zh8YBSSfBjlGAA4AAAAZCAZAADw"+"/X/o+RIAeAEUAET6EgAg6ZF8aBSSfP////9gFJJ8AAAUAPITknxkIBkAUCAZAAAAAACg4hgAaOEBAAcAAACQ+R"+"IAAAAAAJD6EgAg6ZF8YACSfP////9dAJJ8++6AfAAAFAAAAAAAB++AfKjXPgAgAHAAAAAAAADw/X8gAHAAAAAA"+"AEwBAABQIBkARwBPAAAAAABg+hIALgBCALD/EgDYmoN8JAAAAP////8H74B8nApFAFAgGQCo1z4AIABwACAgAA"+"C6m9+S2vTKAfB+A9Pa9MoBAAAAANCEFQAAAAAAdhIAACABAAABAAAAAAAUANz4EgA2LmJtOPsSACDpkXzgAZJ8"+"/////9sBknx/moB8AAAUAAgAFACQmoB8qNc+AKhySAAAAAAASIUVACwBAAAsAQAABI9DAEiFFQBgUhcA0IQVAE"+"yFFQAkc0gA/////wEAAACAj0MASIUVACwAAAAADwAPAAAISgAdCBxIkKABBAUTOjBwEKFCgQwbOkwYUeLEgRUt"+"Xsyo0SHHjgg+dgQA4COCkydJkuSIEoFKlRlRvnxZMeVMmgxd3pzJcOdOAwEBADs="+"' class='"+PC+"imagen_logo' width='15' height='15' "+"alt='www.wextensible.com' title='www.wextensible.com' /></a><br />"+"<input type='button' class='"+PC+"numero' value='1'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"numero' value='2'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"numero' value='3'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"operacion' value='+'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"operacion' value='../../' "+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"id='"+PC+"div'"+"/><input type='button' class='"+PC+"operacion' value='m+' "+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"id='"+PC+"mmas' title='suma a la memoria'/><br />"+"<input type='button' class='"+PC+"numero' value='4'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"numero' value='5'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"numero' value='6'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"operacion' value='-'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"operacion' value='%' "+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"id='"+PC+"porcen'"+"/><input type='button' class='"+PC+"operacion' value='m-' "+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"id='"+PC+"mmenos'"+"title='resta de la memoria' /><br />"+"<input type='button' class='"+PC+"numero' value='7'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"numero' value='8'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"numero' value='9'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"operacion' value='*' "+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"id='"+PC+"por'"+"/><input type='button' class='"+PC+"operacion' value='sqr' "+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"id='"+PC+"raiz' title='raíz cuadrada'"+"/><input type='button' class='"+PC+"operacion' value='m=' "+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"id='"+PC+"migual' title='extrae memoria' /><br />"+"<input type='button' class='"+PC+"numero' value='.'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"numero' value='0'"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"operacion' value='00'  "+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"title='añade dos ceros'"+"/><input type='button' class='"+PC+"operacion' value='='"+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"/><input type='button' class='"+PC+"operacion' value='+-' "+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"id='"+PC+"sign' title='cambia el signo'"+"/><input type='button' class='"+PC+"operacion' value='mc' "+"onclick = '"+this.nombre+".calcula(this.value, true)' "+"id='"+PC+"mcancela' title='cancela memoria' />"+"</div>";var elemento=document.getElementById(this.idDondePoner);if(elemento!=null){elemento.innerHTML=thtml;}else{alert("Error, se esperaba un elemento HTML con id 'dondePoner' para "+"crear una calculadora '"+this.nombre+"'");return;}}catch(e){alert("Error al crear dinámicamente la interfaz para la calculadora '"+this.nombre+"': "+e.message);}};tempConstructor.prototype.tipoCaracter=function(caracter){try{if(caracter.length>1){return "operacion";}else{if(".0123456789".indexOf(caracter)!=-1){return "digito";}else if("+-*/%=\r".indexOf(caracter)!=-1){return "operacion";}else{return "nulo";}}}catch(e){alert("Error en método tipoCaracter() de la calculadora '"+this.nombre+"': "+e.message);}};tempConstructor.prototype.enfocaPantalla=function(){try{if(!this.hayUnOperando){document.getElementById(PC+this.nombre+"pantalla").value="";}}catch(e){alert("Error en método enfocaPantalla() de la calculadora '"+this.nombre+"': "+e.message);}};tempConstructor.prototype.entrarPantalla=function(eventoEntrante){try{var evento=eventoEntrante||window.event;var codigoAscii=evento.charCode||evento.keyCode;var car=String.fromCharCode(codigoAscii);return this.calcula(car,false);}catch(e){alert("Error en método tipoCaracter() de la calculadora '"+this.nombre+"': "+e.message);return false;}};tempConstructor.prototype.presentar=function(valor){try{var pantalla=document.getElementById(PC+this.nombre+"pantalla");if(isNaN(valor)){pantalla.value="Error!";}else{pantalla.value=valor;}}catch(e){alert("Error en método presentar() de la calculadora '"+this.nombre+"': "+e.message);}};tempConstructor.prototype.calcula=function(caracter,desdeBoton){try{var pantalla=document.getElementById(PC+this.nombre+"pantalla");var tipo=this.tipoCaracter(caracter);if(tipo=="nulo"){return false;}else if(tipo=="digito"){this.hayUnOperador=false;if(desdeBoton){if(!this.hayUnOperando){pantalla.value=caracter;this.hayUnOperando=true;}else{pantalla.value=pantalla.value+caracter;}}else{if(!this.hayUnOperando){pantalla.value="";this.hayUnOperando=true;}}return true;}else if(tipo=="operacion"){this.hayUnOperando=false;if(this.hayUnOperador&&(caracter!="can"))return false;this.hayUnOperador=true;var pant=0;pant=pantalla.value;var str=pantalla.value;var longitud=str.length;if(caracter=="\r")caracter="=";this.operacionActual=caracter;switch(this.operacionActual){case "can":pantalla.value="0";this.acumulador=0;this.operacionUltima="";this.operacionActual="";this.hayUnOperador=false;break;case "bor":pantalla.value="";this.hayUnOperando=false;this.hayUnOperador=false;break;case "ret":if(longitud==1){pantalla.value="";this.hayUnOperando=false;}else if(longitud>1){pantalla.value=str.substr(0,longitud-1);this.hayUnOperando=true;}this.hayUnOperador=false;break;case "sqr":if(longitud>0){if(pant>=0){pant=Math.sqrt(pant);this.presentar(pant);}this.hayUnOperando=true;this.hayUnOperador=false;}break;case "+-":if(longitud>0){pant=(-1)*pant;this.presentar(pant);this.hayUnOperando=true;this.hayUnOperador=false;}break;case "00":if(pant!=0){pantalla.value=pantalla.value+"00";this.hayUnOperando=true;this.hayUnOperador=false;}break;case "%":switch(this.operacionUltima){case "+":pant=1+(pant/100);break;case "-":pant=1-(pant/100);break;case "*":pant=pant/100;break;case "/":pant=100/pant;break;default:pant=0;break;}this.acumulador=this.acumulador*pant;this.operacionUltima="";this.hayUnOperador=false;this.hayUnOperando=true;this.presentar(this.acumulador);break;case "mc":this.memoria=0;this.hayUnOperador=false;break;default:switch(this.operacionUltima){case "":this.acumulador=pant;break;case "+":this.acumulador=-(-this.acumulador-pant);this.presentar(this.acumulador);break;case "-":this.acumulador=this.acumulador-pant;this.presentar(this.acumulador);break;case "*":this.acumulador=this.acumulador*pant;this.presentar(this.acumulador);break;case "/":this.acumulador=this.acumulador/pant;this.presentar(this.acumulador);break;default:alert("Error función normal "+caracter+"'");break;}switch(this.operacionActual){case "=":this.operacionUltima="";this.hayUnOperador=false;this.hayUnOperando=true;this.presentar(this.acumulador);break;case "m+":this.memoria=-(-this.memoria-this.acumulador);this.hayUnOperador=false;break;case "m-":this.memoria=this.memoria-this.acumulador;this.hayUnOperador=false;break;case "m=":this.acumulador=this.memoria;this.presentar(this.memoria);this.hayUnOperador=false;break;default:this.operacionUltima=this.operacionActual;break;}break;}return false;}return false;}catch(e){alert("Error en método calcula() de la calculadora '"+this.nombre+"': "+e.message);return false;}};return tempConstructor;})();};