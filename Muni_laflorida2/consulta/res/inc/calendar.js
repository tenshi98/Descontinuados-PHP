var Wextensible=Wextensible||{};Wextensible.CALENDAR_JS=function(){Wextensible.Calendar=(function(){var wxG=Wextensible.general;var DIA_INICIO=6;var RECTIF=Array(0,3,3,6,1,4,6,2,5,0,3,5);;var GAUSS_PASCUA=Array(Array(1583,1699,22,2),Array(1700,1799,23,3),Array(1800,1899,23,4),Array(1900,2099,24,5),Array(2100,2199,24,6),Array(2200,2299,25,0));var FESTIVOS=Array(Array(1,1,"Año Nuevo",1),Array(1,5,"Dia del Trabajo",1),Array(21,5,"Glorias Navales",1),Array(29,6,"San Pedro y San Pablo",1),Array(16,7,"Virgen del Carmen",1),Array(15,8,"Asunción de la Virgen",1),Array(18,9,"Independencia Nacional",1),Array(19,9,"Glorias del Ejército",1),Array(12,10,"Encuentro de Dos Mundos",1),Array(31,10,"Iglesias Evangélicas y Protestantes",1),Array(1,11,"Todos los Santos",1),Array(8,12,"Inmaculada Concepción",1),Array(25,12,"Navidad",1));function calculaPascua(anyo){var pascua=Array(0,0);var a=anyo%19;var b=anyo%4;var c=anyo%7;var f=0;var g=0;var encontrado=false;for(var k=0;k<GAUSS_PASCUA.length;k++){if((anyo>=GAUSS_PASCUA[k][0])&&(anyo<=GAUSS_PASCUA[k][1])){f=GAUSS_PASCUA[k][2];g=GAUSS_PASCUA[k][3];encontrado=true;break;}}if(encontrado){var d=(19*a+f)%30;var e=(2*b+4*c+6*d+g)%7;if((d+e)<10){pascua[0]=d+e+22;pascua[1]=3;}else{pascua[0]=d+e-9;pascua[1]=4;}if(pascua[1]==4){if(pascua[0]==26){pascua[0]=19;}else if((pascua[0]==25)&&(d==28)&&(e==6)&&(a>10)){pascua[0]=18;}}}return pascua;}function buscaDiaSemana(dia,mes,anyo){var diferDias=dia+DIA_INICIO;diferDias+=RECTIF[mes-1];diferDias+=(anyo-wxG.ANYO_INICIO);diferDias+=parseInt((anyo-wxG.ANYO_INICIO)/4);var j=parseInt((anyo-wxG.ANYO_INICIO)/100);var k=parseInt((anyo-wxG.ANYO_INICIO)/400);diferDias-=(j-k);if((wxG.esBisiesto(anyo))&&(mes>2))diferDias++;diferDias=diferDias%7;return diferDias;}var tempConstructor=function(nombreInstancia,dondeTabla,dondeTitulo,fecha,conSeleccionDia){this.creado=false;this.nombre="";if((nombreInstancia!=null)&&(nombreInstancia!="")){if(typeof(nombreInstancia)=="string"){this.nombre=nombreInstancia;}else{alert("Error al crear un calendario: el nombreInstancia es obligatorio"+"e igual a la variable de la instancia de este calendario.");return;}}else{alert("Error al crear un calendario: el nombreInstancia es obligatorio");return;}this.idDondeTabla="";if((dondeTabla!=null)&&(dondeTabla!="")){if(typeof(dondeTabla)=="string"){this.idDondeTabla=dondeTabla;}else{alert("Error, se esperaba el argumento 'dondeTabla' como un string para "+"crear el calendario '"+this.nombre+"'");return;}}else{alert("Error, se esperaba el argumento 'dondeTabla' para "+"crear el calendario '"+this.nombre+"'");return;}this.idDondeTitulo="";if((dondeTitulo!=null)&&(dondeTitulo!="")){if(typeof(dondeTitulo)=="string"){this.idDondeTitulo=dondeTitulo;}else{alert("Error, se esperaba el argumento 'dondeTitulo' como un string para "+"crear el calendario '"+this.nombre+"'");return;}}else{}var esHoy=wxG.fechaActual();this.dia=esHoy[1];this.mes=esHoy[2];this.anyo=esHoy[3];if((fecha!=null)&&(fecha!="")){var arr=wxG.compruebaFecha(fecha);if(arr!=null){this.dia=arr[0];this.mes=arr[1];this.anyo=arr[2];}else{alert("Error, el argumento 'fecha' es incorrecto para "+"crear el calendario '"+this.nombre+"'");return;}}this.seleccionDia=false;if(conSeleccionDia!=null){this.seleccionDia=conSeleccionDia;}this.estiloFestivo=Array("color: maroon","color: red","color: blue");this.estiloDiaActual="background-color: yellow";this.estiloDiaSeleccionado="outline: green double 4px";this.estiloDiaNoSeleccionado="outline: none";this.creado=true;};tempConstructor.prototype.construyeCalendario=function(){try{var ubicaTabla=document.getElementById(this.idDondeTabla);if(ubicaTabla==null){alert("No se pudo ubicar la tabla del calendario '"+this.nombre+"' en el id='"+this.idUbicaTabla+"'");return;}var mesCorto=wxG.NOMBRES_MES[this.mes-1].substring(0,3);var mesCortoAnyo=mesCorto.toUpperCase()+" "+this.anyo;var ubicaTitulo=null;if(this.idDondeTitulo!=""){ubicaTitulo=document.getElementById(this.idDondeTitulo);if(ubicaTitulo!=null){if(ubicaTitulo.tagName.toLowerCase()=="input"){ubicaTitulo.value=mesCortoAnyo;ubicaTitulo.title="Cambiar mes (1-12) y año (1601-2299), introducir 'm/aaaa'";}else{ubicaTitulo.innerHTML=mesCortoAnyo;}}else{alert("No se pudo ubicar el título del calendario '"+this.nombre+"' en el id='"+this.idUbicaTitulo+"'");return;}}else{}var juevesSanto=999;var mesJuevesSanto=999;var viernesSanto=999;var mesViernesSanto=999;if((this.mes==3)||(this.mes==4)){var pasc=calculaPascua(this.anyo);if((pasc[0]>0)&&(pasc[1]>0)){juevesSanto=pasc[0]-3;mesJuevesSanto=pasc[1];if(juevesSanto<1){juevesSanto=31+juevesSanto;mesJuevesSanto=3;}viernesSanto=pasc[0]-2;mesViernesSanto=pasc[1];if(viernesSanto<1){viernesSanto=31+viernesSanto;mesViernesSanto=3;}}}var thtml="<table border='0'>";if(this.idDondeTitulo==""){thtml+="<caption>"+mesCortoAnyo+"</caption>";}if(wxG.esBisiesto(this.anyo)){wxG.DIAS_MES[1]=29;}else{wxG.DIAS_MES[1]=28;}var numLetras=2;thtml+="<tr><th>"+wxG.NOMBRES_DIAS_SEMANA[0].substring(0,numLetras)+"</th>"+"<th>"+wxG.NOMBRES_DIAS_SEMANA[1].substring(0,numLetras)+"</th>"+"<th>"+wxG.NOMBRES_DIAS_SEMANA[2].substring(0,numLetras)+"</th>"+"<th>"+wxG.NOMBRES_DIAS_SEMANA[3].substring(0,numLetras)+"</th>"+"<th>"+wxG.NOMBRES_DIAS_SEMANA[4].substring(0,numLetras)+"</th>"+"<th>"+wxG.NOMBRES_DIAS_SEMANA[5].substring(0,numLetras)+"</th>"+"<th style=\u0022"+this.estiloFestivo[0]+"\u0022>"+wxG.NOMBRES_DIAS_SEMANA[6].substring(0,numLetras)+"</th></tr>";var j=buscaDiaSemana(1,this.mes,this.anyo);var k=1;var n=1;var blancos=true;var diasMes=wxG.DIAS_MES[this.mes-1];while(k<=diasMes){thtml+="<tr>";for(var i=0;i<7;i++){thtml+="<td ";if(((j!=i)&&(k<=6)&&(blancos))||(k>diasMes)){thtml+=">";}else{blancos=false;var esFestivo=false;var fiesta="";var region=0;for(var f=0;f<FESTIVOS.length;f++){if((FESTIVOS[f][0]==k)&&(FESTIVOS[f][1]==this.mes)){esFestivo=true;fiesta=FESTIVOS[f][2];region=FESTIVOS[f][3];break;}}if((this.mes==3)||(this.mes==4)){if((this.mes==mesJuevesSanto)&&(k==juevesSanto)){esFestivo=true;region=1;fiesta="Jueves Santo";}if((this.mes==mesViernesSanto)&&(k==viernesSanto)){esFestivo=true;region=1;fiesta="Viernes Santo";}}var estilo="";if(i==6)estilo=this.estiloFestivo[0];if(esFestivo){estilo=this.estiloFestivo[region];thtml+=" title='"+fiesta+"'";}var hoy=wxG.fechaActual();if((k==hoy[1])&&(this.mes==hoy[2])&&(this.anyo==hoy[3])){if(estilo!="")estilo+="; ";estilo+=this.estiloDiaActual;}if(estilo!="")thtml+=" style='"+estilo;if(this.seleccionDia){if(this.dia==k){if(estilo!=""){thtml+="; ";}else{thtml+=" style='";}thtml+=this.estiloDiaSeleccionado+"' ";}else if(estilo!=""){thtml+="' ";}thtml+=" onclick = \u0022"+this.nombre+".seleccionarDia(this);\u0022 ";}else if(estilo!=""){thtml+="' ";}thtml+=">"+k;k++;}thtml+="</td>";}thtml+="</tr>";}thtml+="</table>";ubicaTabla.innerHTML=thtml;}catch(e){alert("Error en calendario '"+this.nombre+"' con this.construyeCalendario(): "+e.message);}};tempConstructor.prototype.cambiaEstiloDias=function(estilo,queDia){try{if(this.creado){switch(queDia){case "domingo":{this.estiloFestivo[0]=estilo;break;}case "fiesta-estatal":{this.estiloFestivo[1]=estilo;break;}case "fiesta-autonomica":{this.estiloFestivo[2]=estilo;break;}case "dia-actual":{this.estiloDiaActual=estilo;break;}case "dia-seleccionado":{this.estiloDiaSeleccionado=estilo;break;}case "dia-no-seleccionado":{this.estiloDiaNoSeleccionado=estilo;break;}}}}catch(e){alert("Error en calendario '"+this.nombre+"' con this.cambiaEstiloDias(): "+e.message);}};tempConstructor.prototype.situaHoy=function(){try{if(this.creado){var hoy=wxG.fechaActual();this.dia=hoy[1];this.mes=hoy[2];this.anyo=hoy[3];this.construyeCalendario();}}catch(e){alert("Error en calendario '"+this.nombre+"' con this.situaHoy(): "+e.message);}};tempConstructor.prototype.situaFecha=function(fechaString){try{if(this.creado){var arrFecha=wxG.compruebaFecha(fechaString);if(arrFecha!=null){this.dia=arrFecha[0];this.mes=arrFecha[1];this.anyo=arrFecha[2];this.construyeCalendario();return fechaString;}}return "Error";}catch(e){alert("Error en calendario '"+this.nombre+"' con this.situaFecha(): "+e.message);}};tempConstructor.prototype.mueveCalendar=function(masMenos){try{if(this.creado){var mes=this.mes;var anyo=this.anyo;if(masMenos==1){mes++;if(mes>12){mes=1;anyo++;if(anyo>wxG.ANYO_FIN)return;}}else{mes--;if(mes<1){mes=12;anyo--;if(anyo<wxG.ANYO_INICIO)return;}}this.mes=mes;this.anyo=anyo;var diasMes=wxG.DIAS_MES[mes-1];if((wxG.esBisiesto(anyo))&&(mes==2))diasMes++;if(this.dia>diasMes)this.dia=diasMes;this.construyeCalendario();}}catch(e){alert("Error en calendario '"+this.nombre+"' con this.mueveCalendar(): "+e.message);}};tempConstructor.prototype.entraFecha=function(inpute){try{var ubicaTabla=document.getElementById(this.idDondeTabla);var ubicaTitulo=document.getElementById(this.idDondeTitulo);if((this.creado)&&(ubicaTabla!=null)&&(ubicaTitulo!=null)&&(ubicaTitulo.tagName.toLowerCase()=="input")){var dato=inpute.value;var arr=dato.split(" ");var texto=this.mes+"/"+this.anyo;if(arr.length==2){var mes=0;for(var i=0;i<wxG.NOMBRES_MES.length;i++){var mesCorto=wxG.NOMBRES_MES[i].substring(0,3);mesCorto=mesCorto.toUpperCase();if(mesCorto==arr[0]){mes=i+1;break;}}if(mes>0){texto=mes+"/"+arr[1];}}inpute.value=texto;}}catch(e){alert("Error en calendario '"+this.nombre+"' con this.entraFecha(): "+e.message);}};tempConstructor.prototype.mueveMesAnyo=function(inpute){try{var ubicaTabla=document.getElementById(this.idDondeTabla);var ubicaTitulo=document.getElementById(this.idDondeTitulo);if((this.creado)&&(ubicaTabla!=null)&&(ubicaTitulo!=null)&&(ubicaTitulo.tagName.toLowerCase()=="input")){var dato=inpute.value;if((dato!="")&&(dato!=null)){if((dato.length==6)||(dato.length==7)){if(dato.indexOf("/")>-1){var arr=dato.split("/");if(!isNaN(arr[0])){var unMes=parseInt(arr[0]);if((unMes>0)&&(unMes<13)){if(!isNaN(arr[1])){var unAnyo=parseInt(arr[1]);if((unAnyo>=wxG.ANYO_INICIO)&&(unAnyo<=wxG.ANYO_FIN)){this.mes=unMes;this.anyo=unAnyo;var diasMes=wxG.DIAS_MES[unMes-1];if((wxG.esBisiesto(unAnyo))&&(unMes==2))diasMes++;if(this.dia>diasMes)this.dia=diasMes;this.construyeCalendario();return;}}}}}}}var mesCorto=wxG.NOMBRES_MES[this.mes-1].substring(0,3);var thtml=mesCorto.toUpperCase()+" "+this.anyo;inpute.value=thtml;}}catch(e){alert("Error en calendario '"+this.nombre+"' con this.mueveMesAnyo(): "+e.message);}};tempConstructor.prototype.devuelveFecha=function(formato){try{switch(formato.toLowerCase()){case("fecha-larga"):return this.dia+"/"+this.mes+"/"+this.anyo;case("fecha-corta"):return this.dia+"/"+this.mes+"/"+this.anyo.toString().substring(2,4);case("fecha-dia-semana"):{var dsem=buscaDiaSemana(this.dia,this.mes,this.anyo);return wxG.NOMBRES_DIAS_SEMANA[dsem]+", "+this.dia+" de "+wxG.NOMBRES_MES[this.mes-1]+" de "+this.anyo;}case "array":return new Array(this.dia,this.mes,this.anyo);case "date":return new Date(this.anyo,this.mes-1,this.dia);}}catch(e){alert("Error en calendario '"+this.nombre+"' con this.devuelveFecha(): "+e.message);return null;}};tempConstructor.prototype.mensaje=function mensaje(){var men="Se indican las fiestas estatales y autonómicas de uso más frecuente en España. ";men+="Pueden existir otras fiestas de carácter autonómico que no se reflejan. ";men+="Algunas fiestas estatales pueden ser sustituidas por locales en otras fechas. ";men+="Si caen en domingo pueden ser trasladadas a lunes. Consulte la legislación estatal y ";men+="autonómica al respecto para cada año.";alert(men);};tempConstructor.prototype.verComoEs=function(){try{var cad="El calendario no se ha creado.";if(this.creado){cad="<p>PROPIEDADES DEL CALENDARIO <br/>";for(var unaPropiedad in this){if(typeof(this[unaPropiedad])!="function"){if(this[unaPropiedad]==null){cad+=unaPropiedad+": NULO<br />";}else{cad+=unaPropiedad+": "+this[unaPropiedad].toString()+"<br />";}}}cad+="</p>";}return cad;}catch(e){alert("Error en calendario '"+this.nombre+"' con verComoEs(): "+e.message);return "";}};tempConstructor.prototype.borrarSeleccionDia=function(){try{if(this.creado){var ubicaTabla=document.getElementById(this.idDondeTabla);if(ubicaTabla!=null){var coleccion=ubicaTabla.getElementsByTagName("table");if(coleccion.length>0){var tabla=coleccion[0];var celdas=tabla.getElementsByTagName("td");for(var i=0;i<celdas.length;i++){var dia=celdas[i].innerHTML;if(dia!=""){celdas[i].style.cssText+="; "+this.estiloDiaNoSeleccionado;}}}}}}catch(e){alert("Error en calendario '"+this.nombre+"' con this.borrarSeleccionDia(): "+e.message);}};tempConstructor.prototype.seleccionarDia=function(celda){try{if(this.creado){this.borrarSeleccionDia();this.dia=parseInt(celda.innerHTML);celda.style.cssText+="; "+this.estiloDiaSeleccionado;}}catch(e){alert("Error en calendario '"+this.nombre+"' con this.seleccionarDia(): "+e.message);}};return tempConstructor;})();};